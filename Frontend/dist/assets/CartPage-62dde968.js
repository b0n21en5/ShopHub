import{R as z,j as e,F as f,g as D,r as _,h as $,b as L,e as p,_ as d,L as b,i as M,l as F}from"./index-3d8f536d.js";const J="_remove_item_modal_overlay_1c7f2_1",T="_remove_item_modal_1c7f2_1",K="_heading_1c7f2_69",q="_buttons_1c7f2_81",V="_btn_1c7f2_93",Y="_cancel_btn_1c7f2_119",B="_remove_btn_1c7f2_135",r={remove_item_modal_overlay:J,remove_item_modal:T,heading:K,buttons:q,btn:V,cancel_btn:Y,remove_btn:B},H=({setShowRemoveModal:a,removeFromCart:m,productId:u})=>z.createPortal(e.jsxs("div",{className:r.remove_item_modal_overlay,onClick:()=>a(!1),children:[e.jsxs("div",{className:r.remove_item_modal,onClick:l=>l.stopPropagation(),children:[e.jsx("div",{className:r.heading,children:"Remove Item"}),e.jsx("span",{children:"Are you sure you want to remove this item?"}),e.jsxs("div",{className:r.buttons,children:[e.jsx("div",{className:`${r.btn} ${r.cancel_btn}`,onClick:()=>a(!1),children:"CANCEL"}),e.jsx("div",{className:`${r.btn} ${r.remove_btn}`,onClick:()=>m(u),children:"REMOVE"})]})]}),e.jsx(f,{icon:D,onClick:()=>a(!1)})]}),document.getElementById("modal-root")),X="_cart_cnt_1e3i7_1",G="_missing_1e3i7_13",Q="_head_1e3i7_33",U="_cart_details_1e3i7_77",W="_bor_btm_1e3i7_91",Z="_product_1e3i7_103",ee="_product_det_1e3i7_115",te="_det_top_1e3i7_127",se="_place_cnt_1e3i7_141",ce="_place_btn_1e3i7_165",ae="_price_cnt_1e3i7_193",ie="_off_1e3i7_211",ne="_cart_item_action_1e3i7_227",re="_remove_1e3i7_239",oe="_price_details_cnt_1e3i7_263",_e="_price_details_1e3i7_263",de="_price_top_1e3i7_297",le="_price_main_1e3i7_311",me="_amount_1e3i7_325",pe="_save_1e3i7_341",ue="_authentic_1e3i7_351",he="_mb_place_cnt_1e3i7_377",ve="_recent_products_heading_1e3i7_385",je="_recent_products_cnt_1e3i7_393",xe="_justify_between_1e3i7_403",ge="_price_1e3i7_193",ye="_total_1e3i7_545",be="_mb_place_btn_1e3i7_557",fe="_recent_product_1e3i7_385",Ne="_prodt_name_1e3i7_651",s={cart_cnt:X,missing:G,head:Q,cart_details:U,bor_btm:W,product:Z,product_det:ee,det_top:te,place_cnt:se,place_btn:ce,price_cnt:ae,off:ie,cart_item_action:ne,remove:re,price_details_cnt:oe,price_details:_e,price_top:de,price_main:le,amount:me,save:pe,authentic:ue,mb_place_cnt:he,recent_products_heading:ve,recent_products_cnt:je,justify_between:xe,price:ge,total:ye,mb_place_btn:be,recent_product:fe,prodt_name:Ne},Pe=()=>{const[a,m]=_.useState([]),[u,l]=_.useState(!1),[o,j]=_.useState({price:0,discount:0,total:0,items:0}),[N,w]=_.useState([]),{user:h}=$(t=>t.user),C=L(),x=new Date,S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];_.useEffect(()=>{localStorage.getItem("cart")!==null&&g(JSON.parse(localStorage.getItem("cart"))),P()},[]);const g=async t=>{try{const{data:c}=await p.get(`/api/products/get-multiple?ids=${t}`);m(c)}catch(c){d.error(c.response.data.message),m([])}},P=async()=>{try{const{data:t}=await p.get("/api/products/get-recently-added");w(t)}catch(t){d.error(t.response.data.message)}},k=t=>{let c=JSON.parse(localStorage.getItem("cart"));c=c.filter(i=>i!==t),localStorage.setItem("cart",JSON.stringify(c)),g(c),l(!1),d.success("item removed from cart")},E=()=>{if(a.length){let t=0,c=0,i=0;a.forEach(n=>{t+=n.price,c+=parseInt(n.price*(100-n.discount)/100),i+=Math.ceil(n.price*n.discount/100)}),j(n=>({...n,items:a.length,price:t,discount:i,total:c}))}else j({price:0,discount:0,total:0,items:0})};_.useEffect(()=>{E()},[a]);function I(t){return new Promise(c=>{const i=document.createElement("script");i.src=t,i.onload=()=>{c(!0)},i.onerror=()=>{c(!1)},document.body.appendChild(i)})}const y=async()=>{if(!await I("https://checkout.razorpay.com/v1/checkout.js")){d.error("Razorpay SDK failed to load. Are you online?");return}const c=await p.post("/api/products/payment",{products:a});if(!c){d.error("Server error. Are you online?");return}const{amount:i,id:n,currency:R}=c.data,A={key:"rzp_test_Ao1CK0KgMgwLrb",amount:i.toString(),currency:R,name:"ShopHub Corp",description:"Test Transaction",image:F,order_id:n,handler:async function(v){const O={orderCreationId:n,razorpayPaymentId:v.razorpay_payment_id,razorpayOrderId:v.razorpay_order_id,razorpaySignature:v.razorpay_signature};(await p.post("/api/products/payment/success",{paymentDetails:O,products:a})).data.status==="Payment successful"&&(d.success("Order Placed!"),localStorage.removeItem("cart"),C("/account/orders"))},prefill:{name:"",email:"splitter@example.com",contact:"9999999999"},notes:{address:"Razorpay Corporate Office"},theme:{color:"#61dafb"}};new Razorpay(A).open()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:s.cart_cnt,children:a.length?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:s.cart_details,children:[a.map(t=>e.jsxs("div",{className:s.bor_btm,children:[e.jsxs("div",{className:s.product,children:[e.jsx("img",{src:`/api/products/photo/${t._id}`,alt:t.name,width:100,height:120}),e.jsxs("div",{className:s.product_det,children:[e.jsxs("div",{className:s.det_top,children:[e.jsx("span",{children:t.name}),e.jsxs("span",{children:["Delivery by"," ",`${x.getDate()+t.delivery} ${S[x.getMonth()]}`]})]}),e.jsxs("div",{className:s.price_cnt,children:[t.discount&&e.jsx("strike",{children:t.price}),e.jsxs("div",{children:["₹",t.discount?parseInt(t.price*(100-t.discount)/100):t.price,t.discount&&e.jsxs("span",{className:s.off,children:[t.discount,"% off"]})]})]})]})]}),e.jsxs("div",{className:s.cart_item_action,children:[e.jsx("div",{className:s.cart_quantity}),e.jsx("div",{className:s.remove,onClick:()=>l(!0),children:"REMOVE"})]}),u&&e.jsx(H,{setShowRemoveModal:l,removeFromCart:k,productId:t._id})]},t._id)),e.jsx("div",{className:s.place_cnt,children:e.jsx("div",{className:s.place_btn,onClick:y,children:"PLACE ORDER"})})]}),e.jsxs("div",{className:s.price_details_cnt,children:[e.jsxs("div",{className:s.price_details,children:[e.jsx("div",{className:s.price_top,children:"PRICE DETAILS"}),e.jsxs("div",{className:s.price_main,children:[e.jsxs("div",{className:s.justify_between,children:[e.jsxs("div",{children:["Price (",o.items," items)"]})," ",e.jsxs("div",{children:["₹",o.price]})]}),e.jsxs("div",{className:s.justify_between,children:[e.jsx("div",{children:"Discount"}),e.jsxs("div",{className:s.save,children:["-₹",o.discount]})]}),e.jsxs("div",{className:s.justify_between,children:[e.jsx("div",{children:"Delivery Charges"}),e.jsxs("div",{children:[e.jsx("strike",{children:"100"}),e.jsx("span",{className:s.save,children:" Free"})]})]}),e.jsxs("div",{className:`${s.amount} ${s.justify_between}`,children:[e.jsx("div",{children:"Total Amount"}),e.jsxs("div",{children:["₹",o.total]})]}),e.jsxs("div",{className:s.save,children:["You will save ₹",o.discount," on this order"]})]})]}),e.jsxs("div",{className:s.authentic,children:[e.jsx(f,{icon:M}),"Safe and Secure Payments.Easy returns.100% Authentic products."]}),e.jsxs("div",{className:s.mb_place_cnt,children:[e.jsxs("div",{className:s.price,children:[e.jsx("strike",{children:o.price}),e.jsx("div",{className:s.total,children:o.total})]}),e.jsx("div",{className:s.mb_place_btn,onClick:y,children:"PLACE ORDER"})]})]})]}):e.jsxs("div",{className:s.missing,children:[e.jsx("img",{width:222,height:162,src:"/src/assets/cart.webp",alt:"no-item-in-cart"}),e.jsx("div",{className:s.head,children:h?"Your cart is empty!":"Missing Cart items?"}),e.jsx("span",{children:h?"Add items to it now.":"Login to see things you added previously"}),h?e.jsx(b,{to:"/",style:{background:"#2874f0"},children:"Shop now"}):e.jsx(b,{to:"/login",children:"Login"})]})}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:s.recent_products_heading,children:"Recently Added"}),e.jsx("div",{className:s.recent_products_cnt,children:N.map(t=>e.jsxs("div",{className:s.recent_product,children:[e.jsx("img",{src:`/api/products/photo/${t._id}`,alt:t.name,width:120,height:148}),e.jsx("div",{className:s.prodt_name,children:t.name.length>16?t.name.substr(0,15)+"...":t.name}),e.jsx("div",{className:s.price_cnt,children:e.jsxs("div",{children:["₹",t.discount?parseInt(t.price*(100-t.discount)/100):t.price,t.discount&&e.jsx("strike",{children:t.price})]})}),t.discount&&e.jsxs("div",{style:{color:"rgb(0, 140, 0)",fontSize:"12px"},children:[t.discount,"% off"]})]}))})]})]})};export{Pe as default};
